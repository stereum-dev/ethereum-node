---
- name: Find service configs
  find:
    paths: "/etc/stereum/services"
  register: all_services

- name: log all_services
  debug:
    var: all_services

- name: Read service file
  slurp:
    src: "{{ config_file_path }}"
  register: service_configuration_raw

- name: Parse service's configuration
  set_fact:
    service_configuration: "{{ service_configuration_raw['content'] | b64decode | from_yaml }}"
    service_configuration_text: "{{ service_configuration_raw['content'] | b64decode }}"

- name: Remove tags from Besu Config
  lineinfile:
    path: "{{ config_file_path }}"
    regexp: "pruning-enabled"
    state: absent
  when:
    - service_configuration.service == "BesuService"

- name: Remove tags from Besu Config
  lineinfile:
    path: "{{ config_file_path }}"
    regexp: "pruning-block-confirmations"
    state: absent
  when:
    - service_configuration.service == "BesuService"

- name: Remove tags from Besu Config
  lineinfile:
    path: "{{ config_file_path }}"
    regexp: "pruning-blocks-retained"
    state: absent
  when:
    - service_configuration.service == "BesuService"