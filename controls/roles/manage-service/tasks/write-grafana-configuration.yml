---
- name: Create directories for Grafana
  file:
    path: "{{ item }}"
    state: directory
    owner: root
    group: root
    mode: 0655
  loop:
    - "{{ stereum_service_configuration.volumes[2].split(':') | first }}/provisioning/datasources"
    - "{{ stereum_service_configuration.volumes[2].split(':') | first }}/provisioning/dashboards"
  become: yes

- name: Copy Grafana's "datasource" file
  copy:
    src: "{{ role_path }}/files/grafana/datasource.yml"
    dest: "{{ stereum_service_configuration.volumes[2].split(':') | first }}/provisioning/datasources"
    mode: 0655
  become: yes
  when: stereum_service_configuration.command.find("GRAFANA_INI_LH") != -1

- name: Copy Grafana's dashboard(s)
  copy:
    src: "{{ role_path }}/files/grafana/provisioning-lh/dashboards/BeaconProcessing.json"
    dest: "{{ stereum_service_configuration.volumes[2].split(':') | first }}/provisioning/dashboards"
    mode: 0655
  become: yes
  when: stereum_service_configuration.command.find("GRAFANA_INI_LH") != -1

# EOF
